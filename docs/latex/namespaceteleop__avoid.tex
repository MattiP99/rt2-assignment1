\hypertarget{namespaceteleop__avoid}{}\doxysection{teleop\+\_\+avoid Namespace Reference}
\label{namespaceteleop__avoid}\index{teleop\_avoid@{teleop\_avoid}}
\doxysubsection*{Classes}
\begin{DoxyCompactItemize}
\item 
class \mbox{\hyperlink{classteleop__avoid_1_1bcolors}{bcolors}}
\item 
class \mbox{\hyperlink{classteleop__avoid_1_1_publish_thread}{Publish\+Thread}}
\end{DoxyCompactItemize}
\doxysubsection*{Functions}
\begin{DoxyCompactItemize}
\item 
def \mbox{\hyperlink{namespaceteleop__avoid_ae8346548ca971192cb148f53370b059f}{get\+Key}} (key\+\_\+timeout)
\item 
def \mbox{\hyperlink{namespaceteleop__avoid_ad848ff43d066e30b9f9262e020ab2d87}{clbk\+\_\+laser}} (\mbox{\hyperlink{namespaceteleop__avoid_a72c00f05811492f6c41512d498042d3f}{msg}})
\item 
def \mbox{\hyperlink{namespaceteleop__avoid_a580cbf1dac188a7b7c099b3de9e09d84}{pop\+\_\+dict}} (dictionary)
\item 
def \mbox{\hyperlink{namespaceteleop__avoid_a3ef8e3109c71bab27b9cc6b42b3ac833}{vels}} (speed, turn)
\item 
def \mbox{\hyperlink{namespaceteleop__avoid_a6fba07555c2a7d13551b4c247c9e80e9}{main}} ()
\end{DoxyCompactItemize}
\doxysubsection*{Variables}
\begin{DoxyCompactItemize}
\item 
string \mbox{\hyperlink{namespaceteleop__avoid_a72c00f05811492f6c41512d498042d3f}{msg}}
\item 
bool \mbox{\hyperlink{namespaceteleop__avoid_a91891811e0623815f4a47644d267f1da}{ok\+\_\+left}} = True
\item 
bool \mbox{\hyperlink{namespaceteleop__avoid_ae6e11ca462c28bc78ae1fe357cea97e6}{ok\+\_\+right}} = True
\item 
bool \mbox{\hyperlink{namespaceteleop__avoid_a623ae3ab2eeb592150cf27a5e19b4def}{ok\+\_\+straight}} = True
\item 
dictionary \mbox{\hyperlink{namespaceteleop__avoid_aa4b593015d9c416d27df92a9448582f5}{move\+Bindings}}
\item 
dictionary \mbox{\hyperlink{namespaceteleop__avoid_a749620507f44129f27c71be762af4dc3}{speed\+Bindings}}
\end{DoxyCompactItemize}


\doxysubsection{Detailed Description}
\begin{DoxyVerb}.. module:: teleop_avoid
    :platform: Unix
    :synopsis: Python module for controlling the robot using the keyboard assisted by an obstacle avoidance algorithm
.. moduleauthor:: Mattia Piras <pirasmattia2299@gmail.com>
Subscribes to:
    /scan
Publishes to:
    /cmd_vel
This is the Third Controlling Modality.
Reads inputs from the keyboard and makes the robot navigate in the environment with an obstacle avoidance algorithm. 
Messages of type Twist() are published to the '/cmd_vel' topic. 
The functionality is quite similar to the teleop_twist_keyboad's one. 
\end{DoxyVerb}
 

\doxysubsection{Function Documentation}
\mbox{\Hypertarget{namespaceteleop__avoid_ad848ff43d066e30b9f9262e020ab2d87}\label{namespaceteleop__avoid_ad848ff43d066e30b9f9262e020ab2d87}} 
\index{teleop\_avoid@{teleop\_avoid}!clbk\_laser@{clbk\_laser}}
\index{clbk\_laser@{clbk\_laser}!teleop\_avoid@{teleop\_avoid}}
\doxysubsubsection{\texorpdfstring{clbk\_laser()}{clbk\_laser()}}
{\footnotesize\ttfamily def teleop\+\_\+avoid.\+clbk\+\_\+laser (\begin{DoxyParamCaption}\item[{}]{msg }\end{DoxyParamCaption})}

\begin{DoxyVerb}This callback function is for detecting the obstacles from laser scan information. 
This subscription allowed me to detect the obstacles in the simulation environment but also their position with 
respect to the robot by slicing the LaserScan array in three parts: front, left and right direction. 
* If no obstacles are detected on the right of the robot the variable ``ok_right`` is set to True, otherwise to False.
* If no obstacles are detected on the left of the robot the variable ``ok_left`` is set to True, otherwise to False.
* If no obstacles are detected in front of the robot the variable ``ok_straight`` is set to True, otherwise to False.
Args:
    msg: sensor_msgs/LaserScan.msg, scan from a planar laser range-finder. 
No Returns. 
\end{DoxyVerb}
 \mbox{\Hypertarget{namespaceteleop__avoid_ae8346548ca971192cb148f53370b059f}\label{namespaceteleop__avoid_ae8346548ca971192cb148f53370b059f}} 
\index{teleop\_avoid@{teleop\_avoid}!getKey@{getKey}}
\index{getKey@{getKey}!teleop\_avoid@{teleop\_avoid}}
\doxysubsubsection{\texorpdfstring{getKey()}{getKey()}}
{\footnotesize\ttfamily def teleop\+\_\+avoid.\+get\+Key (\begin{DoxyParamCaption}\item[{}]{key\+\_\+timeout }\end{DoxyParamCaption})}

\mbox{\Hypertarget{namespaceteleop__avoid_a6fba07555c2a7d13551b4c247c9e80e9}\label{namespaceteleop__avoid_a6fba07555c2a7d13551b4c247c9e80e9}} 
\index{teleop\_avoid@{teleop\_avoid}!main@{main}}
\index{main@{main}!teleop\_avoid@{teleop\_avoid}}
\doxysubsubsection{\texorpdfstring{main()}{main()}}
{\footnotesize\ttfamily def teleop\+\_\+avoid.\+main (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}

\begin{DoxyVerb}In the ``main()`` function I made some other changes from the ``teleop_twist_keyboard`` code, that are:
    * Insertion of an if(active == 3) statement in order to block the code when another modality is running.
    * The keys now must be kept pressed in order to move the robot. I did this by setting the key_timeout variable to 0.1. Such variable was the select() timeout. That means that the select() function waits 0.1 seconds for new inputs at every loop
    * Added the above descripted functions: ``clbk_laser`` and ``pop_dict``
\end{DoxyVerb}
 \mbox{\Hypertarget{namespaceteleop__avoid_a580cbf1dac188a7b7c099b3de9e09d84}\label{namespaceteleop__avoid_a580cbf1dac188a7b7c099b3de9e09d84}} 
\index{teleop\_avoid@{teleop\_avoid}!pop\_dict@{pop\_dict}}
\index{pop\_dict@{pop\_dict}!teleop\_avoid@{teleop\_avoid}}
\doxysubsubsection{\texorpdfstring{pop\_dict()}{pop\_dict()}}
{\footnotesize\ttfamily def teleop\+\_\+avoid.\+pop\+\_\+dict (\begin{DoxyParamCaption}\item[{}]{dictionary }\end{DoxyParamCaption})}

\begin{DoxyVerb}The obstacle avoidance algorithm is based on the modification of the Dictionary for the allowed movements.
Such collision avoidance algorithm just uses the ``.pop(key)`` method that removes and returns the element idexed by key of the dictionary. 
When an obstacle is detected, thanks to the ``/scan`` subscription we also know its direction with respect to the robot, and
this function just pops the index of such direction from the dictionary. In this way the obsatcle
direction is no more allowed and it will be impossible to publish on the /cmd_vel in that direction. 
The ``.pop(key)`` methos is applied by considering all the combinations that the robot could face. 
Args:
    dictionary (dict): allowed movements dictionary
No Returns
\end{DoxyVerb}
 \mbox{\Hypertarget{namespaceteleop__avoid_a3ef8e3109c71bab27b9cc6b42b3ac833}\label{namespaceteleop__avoid_a3ef8e3109c71bab27b9cc6b42b3ac833}} 
\index{teleop\_avoid@{teleop\_avoid}!vels@{vels}}
\index{vels@{vels}!teleop\_avoid@{teleop\_avoid}}
\doxysubsubsection{\texorpdfstring{vels()}{vels()}}
{\footnotesize\ttfamily def teleop\+\_\+avoid.\+vels (\begin{DoxyParamCaption}\item[{}]{speed,  }\item[{}]{turn }\end{DoxyParamCaption})}



\doxysubsection{Variable Documentation}
\mbox{\Hypertarget{namespaceteleop__avoid_aa4b593015d9c416d27df92a9448582f5}\label{namespaceteleop__avoid_aa4b593015d9c416d27df92a9448582f5}} 
\index{teleop\_avoid@{teleop\_avoid}!moveBindings@{moveBindings}}
\index{moveBindings@{moveBindings}!teleop\_avoid@{teleop\_avoid}}
\doxysubsubsection{\texorpdfstring{moveBindings}{moveBindings}}
{\footnotesize\ttfamily dictionary teleop\+\_\+avoid.\+move\+Bindings}

{\bfseries Initial value\+:}
\begin{DoxyCode}{0}
\DoxyCodeLine{1 =  \{}
\DoxyCodeLine{2         \textcolor{stringliteral}{'i'}:(1,0,0,0),}
\DoxyCodeLine{3         \textcolor{stringliteral}{'j'}:(0,0,0,1),}
\DoxyCodeLine{4         \textcolor{stringliteral}{'l'}:(0,0,0,-\/1),}
\DoxyCodeLine{5         \textcolor{stringliteral}{'k'}:(-\/1,0,0,0),}
\DoxyCodeLine{6     \}}

\end{DoxyCode}
\mbox{\Hypertarget{namespaceteleop__avoid_a72c00f05811492f6c41512d498042d3f}\label{namespaceteleop__avoid_a72c00f05811492f6c41512d498042d3f}} 
\index{teleop\_avoid@{teleop\_avoid}!msg@{msg}}
\index{msg@{msg}!teleop\_avoid@{teleop\_avoid}}
\doxysubsubsection{\texorpdfstring{msg}{msg}}
{\footnotesize\ttfamily string teleop\+\_\+avoid.\+msg}

{\bfseries Initial value\+:}
\begin{DoxyCode}{0}
\DoxyCodeLine{1 =  \textcolor{stringliteral}{"""}}
\DoxyCodeLine{2 \textcolor{stringliteral}{"""} + bcolors.BOLD +\textcolor{stringliteral}{"""}}
\DoxyCodeLine{3 \textcolor{stringliteral}{Reading from the keyboard and Publishing to Twist!}}
\DoxyCodeLine{4 \textcolor{stringliteral}{-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{5 \textcolor{stringliteral}{"""} + bcolors.ENDC + bcolors.OKBLUE + bcolors.BOLD + \textcolor{stringliteral}{"""}}
\DoxyCodeLine{6 \textcolor{stringliteral}{[i] go straight    }}
\DoxyCodeLine{7 \textcolor{stringliteral}{[j] turn left}}
\DoxyCodeLine{8 \textcolor{stringliteral}{[l] turn right}}
\DoxyCodeLine{9 \textcolor{stringliteral}{[k] go backwards}}
\DoxyCodeLine{10 \textcolor{stringliteral}{"""} + bcolors.HEADER + bcolors.BOLD +\textcolor{stringliteral}{"""}}
\DoxyCodeLine{11 \textcolor{stringliteral}{[q]/[z] : increase/decrease max speeds by 10\%}}
\DoxyCodeLine{12 \textcolor{stringliteral}{[w]/[x] : increase/decrease only linear speed by 10\%}}
\DoxyCodeLine{13 \textcolor{stringliteral}{[e]/[c] : increase/decrease only angular speed by 10\%}}
\DoxyCodeLine{14 \textcolor{stringliteral}{"""} + bcolors.ENDC + \textcolor{stringliteral}{"""}}
\DoxyCodeLine{15 \textcolor{stringliteral}{"""}}

\end{DoxyCode}
\mbox{\Hypertarget{namespaceteleop__avoid_a91891811e0623815f4a47644d267f1da}\label{namespaceteleop__avoid_a91891811e0623815f4a47644d267f1da}} 
\index{teleop\_avoid@{teleop\_avoid}!ok\_left@{ok\_left}}
\index{ok\_left@{ok\_left}!teleop\_avoid@{teleop\_avoid}}
\doxysubsubsection{\texorpdfstring{ok\_left}{ok\_left}}
{\footnotesize\ttfamily bool teleop\+\_\+avoid.\+ok\+\_\+left = True}

\mbox{\Hypertarget{namespaceteleop__avoid_ae6e11ca462c28bc78ae1fe357cea97e6}\label{namespaceteleop__avoid_ae6e11ca462c28bc78ae1fe357cea97e6}} 
\index{teleop\_avoid@{teleop\_avoid}!ok\_right@{ok\_right}}
\index{ok\_right@{ok\_right}!teleop\_avoid@{teleop\_avoid}}
\doxysubsubsection{\texorpdfstring{ok\_right}{ok\_right}}
{\footnotesize\ttfamily bool teleop\+\_\+avoid.\+ok\+\_\+right = True}

\mbox{\Hypertarget{namespaceteleop__avoid_a623ae3ab2eeb592150cf27a5e19b4def}\label{namespaceteleop__avoid_a623ae3ab2eeb592150cf27a5e19b4def}} 
\index{teleop\_avoid@{teleop\_avoid}!ok\_straight@{ok\_straight}}
\index{ok\_straight@{ok\_straight}!teleop\_avoid@{teleop\_avoid}}
\doxysubsubsection{\texorpdfstring{ok\_straight}{ok\_straight}}
{\footnotesize\ttfamily bool teleop\+\_\+avoid.\+ok\+\_\+straight = True}

\mbox{\Hypertarget{namespaceteleop__avoid_a749620507f44129f27c71be762af4dc3}\label{namespaceteleop__avoid_a749620507f44129f27c71be762af4dc3}} 
\index{teleop\_avoid@{teleop\_avoid}!speedBindings@{speedBindings}}
\index{speedBindings@{speedBindings}!teleop\_avoid@{teleop\_avoid}}
\doxysubsubsection{\texorpdfstring{speedBindings}{speedBindings}}
{\footnotesize\ttfamily dictionary teleop\+\_\+avoid.\+speed\+Bindings}

{\bfseries Initial value\+:}
\begin{DoxyCode}{0}
\DoxyCodeLine{1 = \{}
\DoxyCodeLine{2         \textcolor{stringliteral}{'q'}:(1.1,1.1),}
\DoxyCodeLine{3         \textcolor{stringliteral}{'z'}:(.9,.9),}
\DoxyCodeLine{4         \textcolor{stringliteral}{'w'}:(1.1,1),}
\DoxyCodeLine{5         \textcolor{stringliteral}{'x'}:(.9,1),}
\DoxyCodeLine{6         \textcolor{stringliteral}{'e'}:(1,1.1),}
\DoxyCodeLine{7         \textcolor{stringliteral}{'c'}:(1,.9),}
\DoxyCodeLine{8     \}}

\end{DoxyCode}
