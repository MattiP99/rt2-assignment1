<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>rt2_assignment1: ReadMe</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">rt2_assignment1
   &#160;<span id="projectnumber">1.0</span>
   </div>
   <div id="projectbrief">ros package for a mobile robot and its navigation through a simple environment</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">ReadMe </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>Author: Mattia Piras</p>
<h2><a class="anchor" id="autotoc_md0"></a>
#third assignment for Research Track 1: Course of Robotics Engineering Unige</h2>
<p>In this project, a robot moves in an environment initially unknown to it. Thanks to laser scanners mounted on board the robot is able to build a map of the environment and move without encountering obstacles. It is required that the robot can move in 3 different modes: </p><pre class="fragment">- setting the coordinates of a goal to be achieved and the robot would have to dynamically calculate a path to reach it
- controlling it via keyboard
- controlling it via keyboard with assistance to avoid obstacles
</pre><h2><a class="anchor" id="autotoc_md1"></a>
##INSTALLING AND RUNNING</h2>
<p>Some packages are required; Run the following commands to install them.</p>
<ul>
<li><p class="startli">Install x-term:</p>
<p class="startli">$ sudo apt install xterm</p>
</li>
<li><p class="startli">Download package:</p>
<p class="startli">$ git clone <a href="https://github.com/CarmineD8/slam_gmapping.git">https://github.com/CarmineD8/slam_gmapping.git</a></p>
</li>
<li><p class="startli">Install ros navigation stack:</p>
<p class="startli">$ sudo apt-get install ros-&lt;your_ros_distro&gt;-navigation</p>
</li>
</ul>
<p>In order to run multiple nodes at the same time, a launch script is provided: rt1a3.launch:</p>
<p>&lt;launch&gt;</p>
<p>&lt;env name="ROSCONSOLE_FORMAT" value="${message}"&gt;</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">rt1a3_action_timeout</td><td><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">rt1a3_brake_threshold</td><td></td></tr>
  </table>
  </dd>
</dl>
&lt;node name="final_ui" pkg="final_assignment"
    type="final_ui" required="false" output="screen" launch-prefix="xterm -e"&gt;</td></tr>
  </table>
  </dd>
</dl>
<p>&lt;node name="final_controller" pkg="final_assignment" output="screen" launch-prefix="xterm -e"
    type="final_controller"  &gt; &lt;/launch&gt;</p>
<p>The User can launch the simulation_sim.launch, mvoe_base.launch, rt1a3_teleop.launch and rt1a3.launch</p>
<h2><a class="anchor" id="autotoc_md2"></a>
##Environment and Mapping</h2>
<p>The robot moves in the environment in the figure (Gazebo view):</p>
<p><img src="https://user-images.githubusercontent.com/92534255/155940743-e88f5ab1-e097-4025-a3a5-460ad08b761e.png" alt="gazebo" width="782" class="inline"/></p>
<p>Initially the robot does not have a map of the surrounding environment, but can build it thanks to the laser scanner it is equipped with and thanks to the gmapping package.</p>
<p>The final map, visible on Rviz is as follows:</p>
<p><img src="https://user-images.githubusercontent.com/92534255/155940790-33f4e580-fc23-494b-9d37-f9bdb1d97679.png" alt="rviz" width="487" class="inline"/></p>
<h2><a class="anchor" id="autotoc_md3"></a>
##Project structure</h2>
<p>After running rt1a3.launch, several nodes are active:</p>
<p><img src="https://user-images.githubusercontent.com/92534255/155940813-29d13949-6ece-4888-adce-29b4a70f7460.png" alt="rqt2" width="698" class="inline"/></p>
<p>The \cmd_vel topic of \teleop node is remapped on \controller_cmd_vel. In this way the velocity imposed by the user via keyboard isn't immediately imposed to the robot, but it's controlled by \controller node.</p>
<p>\controller node is also connected to \gazebo and \move_base nodes. It receives the robot's status by \move_base\feedback and publish the goal to reach on \move_base\goal. This node also subscribe on \move_base\goal topic to have a goal feedback. It can cancel current goal using \move_base\cancel topic.</p>
<p>\controller node also receives the laser scanner output on \scan topic by \gazebo node and sends to this node the robot velocity on \cmd_vel topic.</p>
<h2><a class="anchor" id="autotoc_md4"></a>
#PSEUSOCODE</h2>
<h2><a class="anchor" id="autotoc_md5"></a>
Controller_node behavior can be explained by this pseudi code:</h2>
<pre class="fragment">if(current_mode==1){
    autonomousDriving();
}else if(current_mode==2){
    manualDriving();
} else if(current_mode == 3){
    collisionAvoidance();
} else 
    displayText("mode not correct, please check your input",TEXT_DELAY);

autonomousDriving():
    - wait for the actionServer 
    - setGoal: from the user input
    - sendGoal with the actionClient
    - set timeout
    - wait for results from the action server
        - if in time: publish complete TRUE
        - if not in time : publish timeout FALSE

manualDriving():
    - wait for input
        if 'a': ENABLE ASSISTED DRIVING
        if 'p': EXIT THE PROGRAM

assistedDriving(): aka(collisionAvoidance)
    - check input from the user
    - if input different from 'a' (disable assisted) or 'p' (exit)
        - check distances from laser scann
        - modify vel consequently
        - publishes vel 

    -
</pre><h2><a class="anchor" id="autotoc_md6"></a>
user_node behavior can be explained by this pseudi code:</h2>
<pre class="fragment">if input_user==1: // Autonomous Driving
    set mode_srv.req = 1;
    ask for x and y for the goal
    set goal_srv.req.x and goal_srv.req.y 

else if input_user==2
    set mode_srv.req = 2;

else if input_user==3
    set mode_srv.req = 3;

client_mode ...
client_goal ...
cancel_function(): 
    for cancel the goal:
        check if the time is expired
            -if so:
                ros::shutdown()
            -otherwise:
                if pressed 'p':
                publish("cancel");
</pre><h2><a class="anchor" id="autotoc_md7"></a>
# What I used:</h2>
<ul>
<li>two classes</li>
<li><a class="el" href="utils_8h_source.html">utils.h</a> for addictional functions</li>
<li>Asyncronous spinner for decciding the system how many threads utilizing</li>
<li>One waiting queue for increasing the speed of the response for canceling the goal</li>
<li>two personal services:<ul>
<li>Goal_service to send the desired goal once the coordinates are inserted</li>
<li>Behavior_mode_service to send the proper case of utilization of the program</li>
</ul>
</li>
<li>parameter server<ul>
<li>for the timeout</li>
<li>for treshold from the obstancles detected</li>
</ul>
</li>
<li>Pub e Sub:<ul>
<li>to send the cancel message from the user</li>
<li>scan laser per avoidance obstacle</li>
<li>controller_cmd_vel which is cmd_vel remapped</li>
<li>for the timeout</li>
<li>for cancel the goal</li>
<li>state info (for lleting the user if the action is complete or timeout)</li>
</ul>
</li>
<li>Action Client:<ul>
<li>To handle the autonomous driving, for sending the goal, receiving feedback fromth erobot while reaching the goal, for checking the timeout from the server</li>
</ul>
</li>
</ul>
<h1><a class="anchor" id="autotoc_md8"></a>
Possible Improvements:</h1>
<ul>
<li>Implementation of a queue for letting the user to decide in advance a series of goal for the robot to reach</li>
<li>Better use of asyncrhonous spinner</li>
<li>Integration of actionserver function for a better response from this one </li>
</ul>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.17
</small></address>
</body>
</html>
